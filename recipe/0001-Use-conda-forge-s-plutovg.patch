From 7c1f5413fdb645a9c955bb2c3ec157ab5eb68aed Mon Sep 17 00:00:00 2001
From: Mark Harfouche <mark.harfouche@gmail.com>
Date: Sun, 12 Jan 2025 10:07:15 -0500
Subject: [PATCH] Use conda-forge's plutovg

---
 .../hello_imgui_build_lib.cmake               | 26 +++++++++++++++----
 1 file changed, 21 insertions(+), 5 deletions(-)

diff --git a/external/hello_imgui/hello_imgui/hello_imgui_cmake/hello_imgui_build_lib.cmake b/external/hello_imgui/hello_imgui/hello_imgui_cmake/hello_imgui_build_lib.cmake
index 987e64f..31f3d15 100644
--- a/external/hello_imgui/hello_imgui/hello_imgui_cmake/hello_imgui_build_lib.cmake
+++ b/external/hello_imgui/hello_imgui/hello_imgui_cmake/hello_imgui_build_lib.cmake
@@ -279,12 +279,28 @@ function(him_build_imgui)
             _him_checkout_imgui_submodule_if_needed()
             _him_do_build_imgui()
         endif()
-        if (HELLOIMGUI_USE_FREETYPE)
-            _him_add_freetype_to_imgui()
-            if (HELLOIMGUI_USE_FREETYPE_PLUTOSVG)
-                _him_add_freetype_plutosvg_to_imgui()
-            endif()
+        if (WIN32)
+            # Using pkgconfig on windows just didn't work.
+            # Provide the full directories, hardcode this.
+            link_directories(imgui $ENV{LIBRARY_LIB})
+            target_link_libraries(imgui PUBLIC $ENV{LIBRARY_LIB}/plutovg.lib)
+            target_link_libraries(imgui PUBLIC $ENV{LIBRARY_LIB}/plutosvg.lib)
+            target_include_directories(imgui PRIVATE $ENV{LIBRARY_INC}/plutovg)
+            target_include_directories(imgui PRIVATE $ENV{LIBRARY_INC}/plutosvg)
+        else()
+            find_package(PkgConfig)
+            # Add the plutosvg include directory from the prefix
+            pkg_search_module(PLUTOVG REQUIRED plutovg)
+            target_link_libraries(imgui PRIVATE ${PLUTOVG_LIBRARIES})
+            target_include_directories(imgui PRIVATE ${PLUTOVG_INCLUDE_DIRS})
+
+            pkg_search_module(PLUTOSVG REQUIRED plutosvg)
+            target_link_libraries(imgui PRIVATE ${PLUTOSVG_LIBRARIES})
+            target_include_directories(imgui PRIVATE ${PLUTOSVG_INCLUDE_DIRS})
         endif()
+        target_compile_definitions(imgui PUBLIC IMGUI_ENABLE_FREETYPE)
+        target_compile_definitions(imgui PUBLIC IMGUI_USE_WCHAR32)
+        target_compile_definitions(imgui PUBLIC IMGUI_ENABLE_FREETYPE_PLUTOSVG)
     endif()
 endfunction()
 
-- 
2.47.1

